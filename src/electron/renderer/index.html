<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline' 'unsafe-eval';
    style-src 'self' 'unsafe-inline';
    img-src 'self' data: blob:;
    font-src 'self' data:;
    connect-src 'self';
    frame-src 'none';
    object-src 'none';
  ">
  <title>Comparateur de Dossiers</title>
  
  <!-- Favicons et ic√¥nes -->
  <link rel="icon" type="image/png" sizes="32x32" href="../../../assets/icon.png">
  
  <!-- Styles de base pour √©viter FOUC -->
  <style>
    /**
     * Styles critiques pour √©viter le Flash of Unstyled Content (FOUC)
     * Ces styles sont appliqu√©s imm√©diatement pendant le chargement
     */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      overflow: hidden;
    }

    #root {
      height: 100%;
      width: 100%;
    }

    /* Loader de d√©marrage */
    .initial-loader {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      z-index: 9999;
    }

    .initial-loader h1 {
      color: white;
      font-size: 1.5rem;
      margin-bottom: 2rem;
      font-weight: 300;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Masquer le loader une fois React charg√© */
    .react-loaded .initial-loader {
      display: none;
    }

    /* Styles pour focus visible */
    body:not(.user-is-tabbing) button:focus,
    body:not(.user-is-tabbing) input:focus,
    body:not(.user-is-tabbing) select:focus,
    body:not(.user-is-tabbing) textarea:focus {
      outline: none;
    }

    .user-is-tabbing button:focus,
    .user-is-tabbing input:focus,
    .user-is-tabbing select:focus,
    .user-is-tabbing textarea:focus {
      outline: 2px solid #667eea;
      outline-offset: 2px;
    }
  </style>
</head>
<body>
  <!-- Conteneur principal React -->
  <div id="root">
    <!-- Loader affich√© pendant le chargement initial -->
    <div class="initial-loader">
      <h1>Comparateur de Dossiers</h1>
      <div class="spinner" aria-label="Chargement en cours"></div>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    // Polyfill pour global avant tout autre script
    if (typeof global === 'undefined') {
      var global = globalThis;
    }
  </script>
  <script>
    // Masquer le loader une fois que React est charg√©
    window.addEventListener('DOMContentLoaded', () => {
      // Observer pour d√©tecter quand React a pris le contr√¥le
      const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
          if (mutation.addedNodes.length > 0) {
            // React a ajout√© des √©l√©ments, masquer le loader
            document.body.classList.add('react-loaded');
            observer.disconnect();
          }
        });
      });

      // Observer les changements dans le conteneur root
      const root = document.getElementById('root');
      if (root) {
        observer.observe(root, {
          childList: true,
          subtree: true
        });
      }

      // S√©curit√© : masquer le loader apr√®s 5 secondes maximum
      setTimeout(() => {
        document.body.classList.add('react-loaded');
        observer.disconnect();
      }, 5000);
    });

    // Configuration globale pour l'accessibilit√©
    document.addEventListener('DOMContentLoaded', () => {
      // V√©rification de l'API Electron
      if (typeof window.electronAPI === 'undefined') {
        console.warn('‚ö†Ô∏è ElectronAPI non disponible - Mode d√©grad√©');
      } else {
        console.log('‚úÖ ElectronAPI disponible');
      }
    });

    // Gestion des erreurs globales avant React
    window.addEventListener('error', (event) => {
      console.error('üö® Erreur avant chargement React:', event.error);
    });
  </script>

  <!-- Chargement du bundle React -->
  <!-- Ce script sera remplac√© par le syst√®me de build -->
  <script type="module" src="../../index.tsx"></script>
</body>
</html>